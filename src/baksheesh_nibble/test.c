#include <stdio.h>
#include <string.h>
#include <assert.h>
#include "baksheesh.h"

/* Test vectors for BAKSHEESH derived from the paper 
   "BAKSHEESH: Similar Yet Different From GIFT      */
const unsigned char keys[8][32] = {
    {0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0, 0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0, 0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0, 0x0,0x0}, //1
    {0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0, 0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0, 0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0, 0x0,0x0}, //2
    {0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0, 0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0, 0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0, 0x0,0x0}, //3
    {0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0, 0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0, 0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0, 0x0,0x0}, //4
    {0xf,0xf,0xf,0xf,0xf,0xf,0xf,0xf,0xf,0xf, 0xf,0xf,0xf,0xf,0xf,0xf,0xf,0xf,0xf,0xf, 0xf,0xf,0xf,0xf,0xf,0xf,0xf,0xf,0xf,0xf, 0xf,0xf}, //5
    {0x2,0x3,0x0,0x2,0x3,0x0,0x2,0x3,0x0,0x2, 0x3,0x0,0x2,0x3,0x0,0x2,0x3,0x0,0x2,0x3, 0x0,0x2,0x3,0x0,0x0,0x1,0x2,0x3,0x4,0x5, 0x6,0x7}, //6
    {0x7,0x6,0x5,0x4,0x3,0x2,0x1,0x0,0x0,0x3, 0x2,0x0,0x3,0x2,0x0,0x3,0x2,0x0,0x3,0x2, 0x0,0x3,0x2,0x0,0x3,0x2,0x0,0x3,0x2,0x0, 0x3,0x2}, //7
    {0x5,0x1,0x9,0x6,0x7,0xe,0x1,0x2,0x3,0x5, 0x2,0x4,0x8,0x9,0xa,0x3,0x3,0xe,0x1,0x6, 0xc,0xb,0x2,0x5,0xb,0xf,0xf,0xe,0x0,0x2, 0x9,0x5}  //8
};
const unsigned char plaintexts[8][32] = {
    {0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0, 0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0, 0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0, 0x0,0x0}, //1
    {0x7,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0, 0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0, 0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0, 0x0,0x0}, //2
    {0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0, 0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0, 0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0, 0x0,0x7}, //3
    {0x4,0x4,0x4,0x4,0x4,0x4,0x4,0x4,0x4,0x4, 0x4,0x4,0x4,0x4,0x4,0x4,0x4,0x4,0x4,0x4, 0x4,0x4,0x4,0x4,0x4,0x4,0x4,0x4,0x4,0x4, 0x4,0x4}, //4
    {0x1,0x1,0x1,0x1,0x1,0x1,0x1,0x1,0x1,0x1, 0x1,0x1,0x1,0x1,0x1,0x1,0x1,0x1,0x1,0x1, 0x1,0x1,0x1,0x1,0x1,0x1,0x1,0x1,0x1,0x1, 0x1,0x1}, //5
    {0xa,0x9,0x8,0x7,0xa,0x9,0x8,0x7,0xa,0x9, 0x8,0x7,0xa,0x9,0x8,0x7,0xa,0x9,0x8,0x7, 0xa,0x9,0x8,0x7,0xa,0x9,0x8,0x7,0xa,0x9, 0x8,0x7}, //6
    {0xa,0x9,0x8,0x7,0x4,0xe,0x6,0xb,0xa,0x9, 0x8,0x7,0x4,0xe,0x6,0xb,0xa,0x9,0x8,0x7, 0x4,0xe,0x6,0xb,0xa,0x9,0x8,0x7,0x4,0xe, 0x6,0xb}, //7
    {0xc,0x1,0x8,0x0,0xa,0x3,0x4,0x9,0x6,0x2, 0x1,0xe,0x5,0x0,0x8,0x7,0xd,0x3,0xf,0x3, 0x6,0xf,0xb,0xa,0x1,0x3,0x5,0x7,0x1,0x5, 0x6,0xe}  //8
};
const unsigned char ciphertexts[8][32] = {
    {0xa,0xa,0x2,0x5,0x3,0x8,0x1,0x5,0x9,0x3, 0x4,0x3,0xa,0x9,0xb,0xa,0x2,0x7,0xa,0x8, 0x7,0xc,0x4,0x6,0xe,0x5,0xe,0xb,0x2,0x0, 0x0,0xc}, //1
    {0x8,0x3,0x4,0x6,0x4,0x8,0xd,0xb,0x6,0xf, 0x9,0x7,0x0,0x4,0x5,0x1,0xa,0x7,0x9,0xd, 0x0,0xf,0xa,0xe,0x6,0x4,0x7,0x7,0xd,0x7, 0xf,0x6}, //2
    {0x5,0x0,0xc,0xc,0xc,0xc,0x2,0xb,0xb,0xb, 0x3,0x2,0xc,0x7,0x6,0xf,0x9,0x2,0xa,0x9, 0x0,0xc,0x4,0x3,0x7,0x3,0x6,0x3,0x3,0xa, 0xb,0x1}, //3
    {0x8,0xb,0xf,0x7,0xd,0x0,0x1,0x1,0xd,0xd, 0x4,0x3,0x4,0xf,0xe,0xe,0xd,0x6,0xf,0xa, 0x2,0xb,0x7,0x6,0x6,0x3,0x0,0x3,0x3,0xd, 0xa,0x7}, //4
    {0xf,0x0,0x1,0xc,0xa,0x8,0x7,0xe,0xf,0x5, 0x7,0x9,0x6,0x0,0x2,0x0,0x7,0x3,0x0,0xf, 0x4,0x9,0xb,0x5,0x4,0xf,0xc,0x0,0xf,0x6, 0x0,0x8}, //5
    {0xa,0x0,0x9,0x4,0xe,0x4,0xf,0x4,0x5,0xd, 0xd,0x8,0xe,0x8,0xf,0x4,0x8,0x5,0x6,0x7, 0x8,0xb,0x3,0x3,0x3,0x5,0xb,0x4,0x5,0x6, 0xe,0xa}, //6
    {0xd,0xa,0xc,0xc,0xd,0x2,0x4,0x4,0x3,0x5, 0x7,0xa,0x6,0x9,0x3,0xe,0xb,0x0,0xc,0xc, 0x4,0x5,0x2,0xe,0xf,0x7,0xf,0xd,0xb,0xb, 0xd,0x3}, //7
    {0x4,0x4,0x2,0x3,0xf,0xb,0xe,0x4,0x9,0x5, 0xc,0xb,0x7,0xa,0xc,0x8,0x0,0x3,0x7,0x8, 0x5,0xd,0x3,0xe,0xe,0xf,0x1,0x6,0xe,0x7, 0xc,0xf}  //8
};

void test_baksheesh_encrypt_decrypt() 
{
    unsigned char P[32], C[32];
    for (int i=0; i<8; ++i)
    {
        BAKSHEESH_CTX *ctx = BAKSHEESH_CTX_new(keys[i]);
        assert(ctx != NULL);
        size_t output_len;
        int enc_result = BAKSHEESH_CTX_encrypt(ctx, plaintexts[i], 32, C, &output_len);
        assert(enc_result == 0);

        int dec_result = BAKSHEESH_CTX_decrypt(ctx, C, 32, P, &output_len);
        assert(dec_result == 0);

        assert(memcmp(plaintexts[i], P, 32) == 0);
        assert(memcmp(ciphertexts[i], C, 32) == 0);
        BAKSHEESH_CTX_free(ctx);
    }
}

void test_baksheesh_null_context() 
{
    unsigned char output[32];
    size_t output_len;

    int enc_result = BAKSHEESH_CTX_encrypt(NULL, plaintexts[0], 32, output, &output_len);
    assert(enc_result != 0);
    int dec_result = BAKSHEESH_CTX_decrypt(NULL, plaintexts[0], 32, output, &output_len);
    assert(dec_result != 0);
}

void test_baksheesh_empty_input() 
{
    unsigned char output[32];
    size_t output_len;

    BAKSHEESH_CTX *ctx = BAKSHEESH_CTX_new(keys[0]);
    assert(ctx != NULL);

    int enc_result = BAKSHEESH_CTX_encrypt(ctx, NULL, 0, output, &output_len);
    assert(enc_result != 0);

    int dec_result = BAKSHEESH_CTX_decrypt(ctx, NULL, 0, output, &output_len);
    assert(dec_result != 0);

    BAKSHEESH_CTX_free(ctx);
}

int main() 
{
    printf("Running BAKSHEESH_CTX_nibble tests...\n");
    test_baksheesh_encrypt_decrypt();
    test_baksheesh_null_context();
    test_baksheesh_empty_input();
    printf("All tests passed successfully.\n");
    return 0;
}